<div class="p-6" data-controller="settings">
  <div class="mt-4">
    <%= link_to 'Назад', request.referer && URI(request.referer).path != request.fullpath ? URI(request.referer).path : moderator_games_path, class: 'bg-gray-300 text-gray-800 py-2 px-4 rounded hover:bg-gray-400' %>
  </div>

  <div>
    <div>
      <%= form_with model: [:moderator, game] do |f| %>
        <div class="space-y-4 p-16">
          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :name, class: 'block text-sm font-medium text-gray-700' %>
            </div>
            <div class="w-3/4">
              <%= f.text_field :name, class: 'mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50' %>
            </div>
          </div>

          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :description, class: 'block text-sm font-medium text-gray-700' %>
            </div>
            <div class="w-3/4">
              <%= f.text_field :description, class: 'mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50' %>
            </div>
          </div>

          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :status, class: 'block text-sm font-medium text-gray-700' %>
            </div>
            <div class="w-3/4">
              <%= f.select :status, options_for_select([['0', 0], ['1', 1], ['2', 2]], f.object.status),
                           class: 'mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50',
                           id: "game_status" %>
              <div id="reason-field" style="<%= f.object.status == 2 ? '' : 'display: none;' %>">
                <%= f.label :reason, "Причина отклонения", class: 'block text-sm font-medium text-gray-700 mt-2' %>
                <%= f.select :reason, [['Непристойный контент', 'Непристойный контент'], ['Реклама', 'Реклама'], ['Плагиат', 'Плагиат']],
                             { include_blank: true },
                             class: 'mt-1 block w-full border-gray-300 rounded-md shadow-sm focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50' %>
              </div>
            </div>
          </div>

          <script>
              document.addEventListener("DOMContentLoaded", function() {
                  const statusSelect = document.getElementById('game_status');
                  const reasonField = document.getElementById('reason-field');

                  function toggleReasonField() {
                      if (statusSelect.value === '2') {
                          reasonField.style.display = 'block';
                      } else {
                          reasonField.style.display = 'none';
                      }
                  }

                  toggleReasonField();
                  statusSelect.addEventListener('change', toggleReasonField);
              });
          </script>

          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :cover, "Обложка", class: "block text-sm font-medium text-gray-700" %>
            </div>
            <div class="w-3/4">
              <label class="block text-sm font-medium text-gray-700 mb-2" for="game_cover">
                Обложка
              </label>
              <%= f.file_field :cover, class: "mt-1 block w-full text-gray-500 file:py-2 file:px-4 file:border file:border-gray-300 file:rounded-md file:bg-gray-100 file:text-sm file:font-medium hover:file:bg-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50" %>

              <% if @game && @game.cover.attached? %>
                <div class="mt-4">
                  <%= image_tag url_for(@game.cover), alt: @game.name,
                                class: "max-h-56 rounded-md bg-gray-200 object-cover object-center group-hover:opacity-75" %>
                </div>
              <% else %>
                <div class="aspect-h-1 aspect-w-1 w-full overflow-hidden rounded-md bg-gray-200 lg:aspect-none group-hover:opacity-75 lg:h-80 mt-4">
                  <img src="https://via.placeholder.com/300" alt="<%= @game.name %>"
                       class="max-h-xs object-cover object-center">
                </div>
              <% end %>
            </div>
          </div>

          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :game_file, "Файл игры",
                             class: "block text-sm font-medium text-gray-700" %>
            </div>
            <div class="w-3/4">
              <label class="block text-sm font-medium text-gray-700 mb-2" for="game_game_file">
                Файл игры
              </label>
              <%= f.file_field :game_file, accept: ".zip,.rar,.7z",
                               class: "mt-1 block w-full text-gray-500 file:py-2 file:px-4 file:border file:border-gray-300 file:rounded-md file:bg-gray-100 file:text-sm file:font-medium hover:file:bg-gray-200 focus:border-blue-500 focus:ring focus:ring-blue-500 focus:ring-opacity-50" %>

              <% if game.game_file.attached? %>
                <p class="mt-2 text-sm text-gray-500">
                  Текущий файл:
                  <%= link_to "Скачать архив", url_for(@game.game_file),
                              download: true,
                              class: "text-indigo-600 hover:text-indigo-900 font-medium underline" %>
                </p>
              <% end %>
            </div>
          </div>

          <div class="flex items-center">
            <div class="w-1/4">
              <%= f.label :tags, "Теги", class: "block text-sm font-medium text-gray-700" %>
            </div>
            <div class="w-3/4">
              <div class="mt-1">
                <%= f.collection_check_boxes(:tag_ids, Tag.all, :id, :name) do |b| %>
                  <div class="flex items-center">
                    <%= b.check_box(class: "mr-2") %>
                    <%= b.label(class: "text-sm font-medium text-gray-700") %>
                  </div>
                <% end %>
              </div>
            </div>
          </div>

          <div class="flex items-center pb-16">
            <div class="w-1/4"></div>
            <div class="w-3/4">
              <div class="mt-6 flex items-center space-x-2">
                <%= f.submit 'Сохранить', class: 'bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600' %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>
</div>